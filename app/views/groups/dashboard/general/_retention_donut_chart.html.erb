<div style="
  margin:   auto;
  width:    240px;
  height:   240px;
  position: relative;
">
  <svg style="position: absolute;">
    <defs>
      <linearGradient id="grad1" x1="0%" y1="0%" x2="100%" y2="0%">
        <stop offset="0%" style="stop-color:#36ad7e; stop-opacity:1" />
        <stop offset="100%" style="stop-color:#5bc5f1; stop-opacity:1" />
      </linearGradient>
    </defs>
  </svg>
  <div id="retention-rate" style="
    position: absolute;
    width:  100%;
    height: 100%;
    z-index: 10;
  "></div>
  <div style="
    display:         flex;
    flex-direction:  column;
    align-items:     center;
    justify-content: center;
    width:  100%;
    height: 100%;
    z-index: 1;
  ">
    <div class="donut-title text-center"><%= KpiDash.new(@group, 'members_ratio').call %> %</div>
    <div class="donut-subtitle text-center"><strong><%= KpiDash.new(@group, 'members_active').call %></strong> ACTIVE MEMBERS</div>
  </div>
</div>

<% content_for :after_js do %>
  <script type="text/javascript">
    function retentionChart() {
      google.charts.load("current", {packages:["corechart"]});
      google.charts.setOnLoadCallback(drawChart);

      function drawChart() {
        var data = google.visualization.arrayToDataTable(<%=
          active_inactive_members = KpiDash.new(@group, 'members').call
          retention_chart = [
            ['Members', 'Number of members'],
            ['Active', active_inactive_members[:active]],
            ['Inactive', active_inactive_members[:inactive]]
          ]
          raw retention_chart.to_json
        %>);

        var options = {
          chartArea: {
            width: '90%',
            height: '90%'
          },
          pieHole: 0.9,
          pieSliceBorderColor: 'transparent',
          pieSliceText: 'none',
          animation: {
            duration: 5000,
            startup: true,
            easing: 'in',
          },
          legend: { position: "none" },
          backgroundColor: { fill:'transparent' },
          slices: {
            0: { color: '#5bc5f1' },
            1: { color: 'transparent' }
          }
        };

        var chart = new google.visualization.PieChart(document.getElementById('retention-rate'));
        google.visualization.events.addListener(chart, 'ready', allReady);
        google.visualization.events.addListener(chart, 'onmouseover', allReady);
        google.visualization.events.addListener(chart, 'onmouseout', allReady);
        chart.draw(data, options);
      }

      function allReady() {
        $("#retention-rate [fill='#5bc5f1']").attr('fill', 'url(#grad1)');
      }
    }
  </script>
<% end %>
